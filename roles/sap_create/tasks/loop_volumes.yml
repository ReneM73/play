- name: Create volume {{ volume.name }}
  ansible.builtin.include_role:
    name: sgs.ontap.volume
  vars:
    state: present
    vserver_name: "{{ vserver_sap_fc }}"
    aggregate_name: "{{ best_aggregate }}"
    volume_name: "{{ volume.name }}"
    size: "{{ volume.size }}"
    snapshot_policy: none
    atime_update: false
    space_guarantee: none
    percent_snapshot_space: 0
    volume_security_style: unix

- name: Loop over qtrees
  ansible.builtin.include_tasks:
    file: loop_qtrees.yml
  loop: "{{ volume.qtrees }}"
  loop_control:
    loop_var: qtree
  when: swapvg_size is not defined or swapvg_size != 0
