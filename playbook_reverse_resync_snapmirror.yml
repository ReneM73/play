---
- name: Set vserver and cluster based on location
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Get matching host based on location
      ansible.builtin.set_fact:
        matched_host: "{{ item }}"
      with_items: "{{ groups['fss_leg'] }}"
      when: hostvars[item].city == location

    - name: Set vserver and cluster facts
      ansible.builtin.set_fact:
        vserver: "{{ hostvars[matched_host].vserver_smb_leg }}"
        cluster_name: "{{ hostvars[matched_host].cluster_name }}"
      when: matched_host is defined

    - name: Display selected vservers and clusters
      ansible.builtin.debug:
        msg: "Primary: vserver={{ vserver }}, cluster={{ cluster_name }}"


